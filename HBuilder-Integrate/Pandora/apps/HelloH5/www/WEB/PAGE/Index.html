<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link href="../fonts/IndexIcon/iconfont.css" rel="stylesheet" />
		<script src="../js/mui.js"></script>
		<script src="js/jquery-2.1.4.min.js"></script>
		<script src="../fnAction/md5-min.js"></script>
		<script src="../fnAction/FunctionAction.js"></script>
		<link href="CSS_ext/Cssext1.css" rel="stylesheet" />
		<script type="text/javascript" src="../../js/common.js"></script>
		<link rel="stylesheet" href="../../css/common.css" />
		<style>
			html,
			body {
				background-color: #efeff4;
			}
			
			p {
				text-indent: 22px;
			}
			
			span.mui-icon {
				font-size: 14px;
				color: #007aff;
				margin-left: -15px;
				padding-right: 10px;
			}
			
			.mui-off-canvas-left {
				color: #fff;
			}
			
			.title {
				margin: 35px 15px 10px;
			}
			
			.title+ .content {
				margin: 10px 15px 35px;
				color: #bbb;
				text-indent: 1em;
				font-size: 14px;
				line-height: 24px;
			}
			
			input {
				color: #000;
			}
			
			.iconfont {
				font-size: 35px;
				position: relative;
				top: 15px;
			}
			
			.MenuName {
				position: relative;
				top: 7px;
			}
			
			#luyou td {
				width: 33%;
				height: 80px;
				text-align: left;
				overflow: hidden;
				padding: 0px;
				margin: 0px;
			}
			
			#luyou {
				margin: auto
			}
			
			* {
				font-family: 微软雅黑;
			}
			
			.caricon {
				height: 40px;
				position: relative;
				top: 6px
			}
			
			.stationName {
				margin-left: 35px;
				font-size: 0.8em;
			}
		</style>
	</head>

	<body>
		<div id="offCanvasWrapper" class="mui-off-canvas-wrap mui-draggable">
			<!--侧滑菜单部分-->
			<aside id="offCanvasSide" class="mui-off-canvas-left">
				<div id="offCanvasSideScroll" class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted">
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right userinfoCenter" style="height:3.8em;">
									<i class="icon iconfont"> &#xe605;</i>&nbsp;&nbsp;&nbsp;<span class="MenuName">个人中心</span>
								</a>
							</li>
							<li class="mui-table-view-cell ">
								<a class="mui-navigate-right offLine" style="height:3.8em">
									<i class="icon iconfont" style="font-size:40px">&#xe604;</i>&nbsp;&nbsp;&nbsp;<span class="MenuName">离线任务</span>
								</a>
							</li>
							<li class="mui-table-view-cell ">
								<a class="mui-navigate-right Weather" style="height:3.8em">
									<i class="icon iconfont" style="font-size:40px">&#xe606;</i>&nbsp;&nbsp;&nbsp;<span class="MenuName">天气</span>
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right Map" style="height:3.8em">
									<i class="icon iconfont">&#xe600;</i>&nbsp;&nbsp;&nbsp;<span class="MenuName">我的位置</span>
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right MessageList" style="height:3.8em">
									<span class="mui-badge mui-badge-primary" id="msgNum">0</span>
									<i class="icon iconfont">&#xe601;</i>&nbsp;&nbsp;&nbsp;<span class="MenuName">消息通知</span>
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right myTasks" style="height:3.8em">
									<i class="icon iconfont">&#xe603;</i>&nbsp;&nbsp;&nbsp;<span class="MenuName">已发车<span id="carNum">0</span>趟</span>
								</a>
							</li>
						</ul>
					</div>
				</div>
			</aside>
			<!--主界面部分-->
			<div class="mui-inner-wrap">
				<header class="mui-bar mui-bar-nav">
					<a href="#offCanvasSide" class="mui-icon mui-action-menu mui-icon-bars mui-pull-left"></a>

					<h1 class="mui-title">主页</h1>
				</header>
				<div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper">
					<div class="mui-scroll" style="overflow:auto">
						<div style=" height: 100px; width: 92%; background-color: #03a2f5; margin:auto; border-radius:5px; margin-top:20px">
							<span style="color:white; font-size:1.6em; position:relative;top:36px; left:10px" id="carid"> </span>
							<img src="../Images/Index/index_car.png" style=" height:70px; position:absolute; right:10%; margin-top:17px" />
						</div>
						<div style=" height: 100px; width: 92%; background-color: white; margin:auto; border-radius:5px; margin-top:20px; text-align:center">
							<span style=" margin-left:10px; margin-top:20px; font-size:1.2em" id="BeginCity"></span> &nbsp;
							<img src="../Images/Index/shifa.png" style=" height:1.5em; margin-top:10px" /> &nbsp;
							<span style=" margin-top: 23px; font-size: 1.2em" id="EndCity"></span><br />
							<div style=" font-size:0.8em; text-align:center; margin-top:10px ">
								<nobr>班次类型：<span id="zb">正班</span>/<span id="jb">加班</span>
									<!--/<span id="db">顶班</span>--></nobr><br /> 路由类型：
								<span id="dc">单程</span>/<span id="wf">往返</span>
							</div>
						</div>

						<div style=" width: 92%; background-color: white; margin:auto; border-radius:5px; margin-top:20px; text-align:center">
							<table style="width:95%" id="luyou" cellpadding="0" cellspacing="0">
							</table>
						</div>
					</div>

					<div class="mui-off-canvas-backdrop"></div>
				</div>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script>
			mui.plusReady(function() {})
			mui.init({
					//下拉刷新、上拉加载
					pullRefresh: {
						//...
					},
					//手势配置
					gestureConfig: {
						//...
					},
					//侧滑关闭
					swipeBack: false, //Boolean(默认false)启用右滑关闭功能

					//监听Android手机的back、menu按键
					keyEventBind: {
						backbutton: true, //Boolean(默认true)关闭back按键监听
						menubutton: false //Boolean(默认true)关闭menu按键监听
					},
					//处理窗口关闭前的业务
					beforeback: function() {
						//... //窗口关闭前处理其他业务详情点击 ↑ "关闭页面"链接查看
					},
					preloadPages: [{
						url: 'userInfoCenter.html',
						id: 'userInfoCenter'
					}, {
						url: 'offLine.html',
						id: 'offLine'
					}, {
						url: "mapOut.html",
						id: "mapOut"
					}, {
						url: "MessageList.html",
						id: "MessageList"
					}],
					  statusBarBackground: '#03a2f5'//设置状态栏颜色,仅iOS可用
				})
				//侧滑容器父节点
			var offCanvasWrapper = mui('#offCanvasWrapper');
			//主界面容器
			var offCanvasInner = offCanvasWrapper[0].querySelector('.mui-inner-wrap');
			//菜单容器
			var offCanvasSide = document.getElementById("offCanvasSide");
			if(!mui.os.android) {
				//document.getElementById("move-togger").classList.remove('mui-hidden');
				var spans = document.querySelectorAll('.android-only');
				for(var i = 0, len = spans.length; i < len; i++) {
					spans[i].style.display = "none";
				}
			}
			//移动效果是否为整体移动
			var moveTogether = false;
			//侧滑容器的class列表，增加.mui-slide-in即可实现菜单移动、主界面不动的效果；
			var classList = offCanvasWrapper[0].classList;
			//变换侧滑动画移动效果；
			mui('.mui-input-group').on('change', 'input', function() {
				if(this.checked) {
					offCanvasSide.classList.remove('mui-transitioning');
					offCanvasSide.setAttribute('style', '');
					classList.remove('mui-slide-in');
					classList.remove('mui-scalable');
					switch(this.value) {
						case 'main-move':
							if(moveTogether) {
								//仅主内容滑动时，侧滑菜单在off-canvas-wrap内，和主界面并列
								offCanvasWrapper[0].insertBefore(offCanvasSide, offCanvasWrapper[0].firstElementChild);
							}
							break;
						case 'main-move-scalable':
							if(moveTogether) {
								//仅主内容滑动时，侧滑菜单在off-canvas-wrap内，和主界面并列
								offCanvasWrapper[0].insertBefore(offCanvasSide, offCanvasWrapper[0].firstElementChild);
							}
							classList.add('mui-scalable');
							break;
						case 'menu-move':
							classList.add('mui-slide-in');
							break;
						case 'all-move':
							moveTogether = true;
							//整体滑动时，侧滑菜单在inner-wrap内
							offCanvasInner.insertBefore(offCanvasSide, offCanvasInner.firstElementChild);
							break;
					}
					offCanvasWrapper.offCanvas().refresh();
				}
			});
			//主界面和侧滑菜单界面均支持区域滚动；
			mui('#offCanvasSideScroll').scroll();
			mui('#offCanvasContentScroll').scroll();
			//实现ios平台原生侧滑关闭页面；
			if(mui.os.plus && mui.os.ios) {
				mui.plusReady(function() { //5+ iOS暂时无法屏蔽popGesture时传递touch事件，故该demo直接屏蔽popGesture功能
					plus.webview.currentWebview().setStyle({
						'popGesture': 'none'
					});
				});
			}
			var userinfo = $.ActionFn.GetlocalStorage("userInfo");
			//window.addEventListener("preAct",function(){

			var DrObj = new Object();
			DrObj.DriType = userinfo.RtnLoginList[0].DriType;
			DrObj.CardCode = userinfo.RtnLoginList[0].CardCode;
			DrObj.DriID = userinfo.RtnLoginList[0].DriID;
			DrObj.HRCode = userinfo.RtnLoginList[0].HRCode;
			$.ActionFn.sendData("DriverTask", DrObj, DriverSuccess);

			function DriverSuccess(msg) {

				//VehicleNum 车牌号
				if(msg.Rtn_Msg = "成功") {
					console.log(JSON.stringify(msg));
					$("#carid").text(msg.Content.GetMyMissionDetailList[0].VehicleNum);
					$("#BeginCity").text(msg.Content.GetMyMissionDetailList[0].NodeName);
					$("#EndCity").text(msg.Content.GetMyMissionDetailList[0].Destination);
					$("#bc").text(msg.Content.GetMyMissionDetailList[0].ShipperTypeStr);
					if(msg.Content.GetMyMissionDetailList[0].SinglePass == "1") {
						$("#dc").css("color", "#03a2f5");
					} else {
						$("#wf").css("color", "#03a2f5");
					}

					if(msg.Content.GetMyMissionDetailList[0].ShipperType == "1") {
						$("#zb").css("color", "#03a2f5");
					} else {
						$("#jb").css("color", "#03a2f5");
					}

					//加载路由详情
					var details = msg.Content.GetMyMissionDetailList;

					var tr = "";
					for(var i = 0; i < details.length; i++) {
						//拼接状态条

						//如果是第一条数据（首发站）
						if(i == 0) {
							//如果出发时间为空，进度条灰色
							if(details[i + 1].SendDateTime == "") {
								tr += '<tr><td style="background-image: url(../Images/Index/first1.png); background-repeat:no-repeat;text-align:center"><span class="stationName">' + details[i].NodeName + '</span><br /></td>';
							} else {
								tr += '<tr><td style="background-image: url(../Images/Index/first.png); background-repeat:no-repeat;text-align:center"><span class="stationName">' + details[i].NodeName + '</span><br /></td>';
							}

						}
						//如果是最后一条数据（终点站）
						else if(i == details.length - 1) {
							//如果到达站时间为空，上一站已经发车进度条半灰
							if(details[i].ReachDateTime == "" && details[i].SendDateTime != "") {
								tr += '<tr><td style="background-image: url(../Images/Index/lastcheng.png); background-repeat:no-repeat;text-align:center"><span class="stationName">' + details[i].NodeName + '</span><br /></td>';
							}
							//如果到达站时间为空，上一站未发车进度条全灰
							else if(details[i].ReachDateTime == "" && details[i].SendDateTime == "") {
								tr += '<tr><td style="background-image: url(../Images/Index/last1.png); background-repeat:no-repeat;text-align:center"><span class="stationName">' + details[i].NodeName + '</span><br /></td>';
							} else {
								tr += '<tr><td style="background-image: url(../Images/Index/last.png); background-repeat:no-repeat;text-align:center"><span class="stationName">' + details[i].NodeName + '</span><br /></td>';
							}

						}
						//否则为中转站
						else {
							//如果出发时间为空，上一站已经发车，进度条半灰色
							if(details[i + 1].SendDateTime == "" && details[i].SendDateTime != "") {
								tr += '<tr><td style="background-image: url(../Images/Index/chenghui.png); background-repeat:no-repeat;text-align:center"><span class="stationName">' + details[i].NodeName + '</span><br /></td>';
							}
							//如果出发时间为空，上一站未发车，进度条全灰色
							else if(details[i + 1].SendDateTime == "" && details[i].SendDateTime != "") {
								tr += '<tr><td style="background-image: url(../Images/Index/center1.png); background-repeat:no-repeat;text-align:center"><span class="stationName">' + details[i].NodeName + '</span><br /></td>';
							} else {
								tr += '<tr><td style="background-image: url(../Images/Index/center.png); background-repeat:no-repeat;text-align:center"><span class="stationName">' + details[i].NodeName + '</span><br /></td>';
							}

						}

						//拼接货车图标和时间
						//发车时间判断
						if((i != details.length - 1) && details[i + 1].SendDateTime == "") {
							tr += '<td><img src="../Images/Index/c_chufa_x.png" class="caricon" /><br /></td>';

						} else if((i != details.length - 1) && details[i + 1].SendDateTime != "") {
							tr += '<td><img src="../Images/Index/c_chufa.png" class="caricon" /><br /><span style="font-size:0.6em">' + details[i + 1].SendDateTime + '</span></td>';

						} else {
							tr += "<td></td>";
						}

						//到达时间判断
						if((i != 0) && details[i].ReachDateTime == "") {
							tr += '<td><img src="../Images/Index/c_daoda_x.png" class="caricon" /><br /></td></tr>';

						} else if((i != 0) && details[i].ReachDateTime != "") {
							tr += '<td><img src="../Images/Index/c_daoda.png" class="caricon" /><br /><span style="font-size:0.6em">' + details[i].ReachDateTime + '</span></td></tr>';

						} else {
							tr += "<td></td><tr>";
						}

						$("#luyou").append(tr);
						tr = "";
					}
				}
			}

			//})
			var msgnum = new Object();
			msgnum.DriveName = userinfo.RtnLoginList[0].DriName;
			$.ActionFn.sendData("GetAllMessageNumber", msgnum, msgSuccess);

			function msgSuccess(msg) {
				$("#msgNum").text(msg.Content.returnList[0].Number);
			}
			var carnum = new Object();
			carnum.CardCode = userinfo.RtnLoginList[0].CardCode;
			carnum.DriType = userinfo.RtnLoginList[0].DriType;
			carnum.DriID = userinfo.RtnLoginList[0].DriID;
			$.ActionFn.sendData("GetHistoryNumber", carnum, carSuccess);

			function carSuccess(msg) {
				$("#carNum").text(msg.Content.returnList[0].Number);
			}
			document.querySelector(".userinfoCenter").addEventListener("tap", function() {
				offCanvasWrapper.offCanvas('close');
				$.ActionFn.selfOpenWindow("userInfoCenter", "userInfoCenter.html");
			})
			document.querySelector(".offLine").addEventListener("tap", function() {
				offCanvasWrapper.offCanvas('close');
				$.ActionFn.selfOpenWindow("offLine", "offLine.html");
			})
			document.querySelector(".Weather").addEventListener("tap", function() {
				offCanvasWrapper.offCanvas('close');
				$.ActionFn.selfOpenWindow("Weather", "Weather.html");
			})
			document.querySelector(".Map").addEventListener("tap", function() {
				offCanvasWrapper.offCanvas('close');
				$.ActionFn.selfFireFunction("mapOut", "preAct", "");
				$.ActionFn.selfOpenWindow("mapOut", "mapOut.html");
			})
			document.querySelector(".MessageList").addEventListener("tap", function() {
				offCanvasWrapper.offCanvas('close');
				$.ActionFn.selfOpenWindow("MessageList", "MessageList.html");
			})
			document.querySelector(".myTasks").addEventListener("tap", function() {
				offCanvasWrapper.offCanvas('close');
				$.ActionFn.selfOpenWindow("MyTasks", "MyTasks.html");
			})
		</script>
	</body>

</html>